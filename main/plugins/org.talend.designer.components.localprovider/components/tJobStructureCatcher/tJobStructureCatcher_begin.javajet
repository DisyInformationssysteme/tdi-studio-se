<%@ jet 
	imports="
		org.talend.core.model.process.INode 
		org.talend.designer.codegen.config.CodeGeneratorArgument
		org.talend.core.model.process.IConnection
		org.talend.core.model.process.IConnectionCategory
	"
%>

<%
	CodeGeneratorArgument codeGenArgument = (CodeGeneratorArgument) argument;
	INode node = (INode)codeGenArgument.getArgument();
	String cid = node.getUniqueName();

%>
	//org.talend.logging.audit.AuditLogger auditLogger = org.talend.logging.audit.AuditLoggerFactory.getAuditLogger();
	for (JobStructureCatcherUtils.JobStructureCatcherMessage jcm : <%=cid %>.getMessages()) {
<%
	for (IConnection conn : node.getOutgoingConnections()) {
		if (conn.getLineStyle().hasConnectionCategory(IConnectionCategory.DATA)) {
%>
		/*
		<%=conn.getName() %>.component_parameters = jcm.getComponent_parameters();
		<%=conn.getName() %>.component_schema = jcm.getComponent_schema();	
    	<%=conn.getName() %>.input_connectors = jcm.getInput_connectors();
    	<%=conn.getName() %>.output_connectors = jcm.getOutput_connectors();
    	<%=conn.getName() %>.connector_name_2_connector_schema = jcm.getConnector_name_2_connector_schema();
		<%=conn.getName() %>.job_name = jcm.getJobName();
		<%=conn.getName() %>.job_id = jcm.getJobId();
		<%=conn.getName() %>.job_version = jcm.getJobVersion();
		<%=conn.getName() %>.system_pid = jcm.getSystemPid();
		*/
<%
		}
	}
%>
		org.talend.logging.audit.Context log_context_<%=cid%> = null;
		if(jcm.getComponent_name() == null) {//job level log
			log_context_<%=cid%> = org.talend.job.audit.JobContextBuilder.create().jobName(jcm.getJobName()).jobId(jcm.getJobId())
				.jobVersion(jcm.getJobVersion()).build();
			auditLogger_<%=cid%>.runjob(log_context_<%=cid%>);
		} else {//component level lop
			log_context_<%=cid%> = org.talend.job.audit.JobContextBuilder.create().jobName(jcm.getJobName()).jobId(jcm.getJobId())
				.jobVersion(jcm.getJobVersion()).connectorType(jcm.getComponent_name()).connectorId(jcm.getComponent_id()).parameters(jcm.getComponent_parameters().toString()).build();
			auditLogger_<%=cid%>.runcomponent(log_context_<%=cid%>);
		}

		
	}
